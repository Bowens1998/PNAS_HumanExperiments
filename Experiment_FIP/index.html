<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Financial Investment Task ‚Äî v1.1.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --ink: #0f172a;
      --muted: #64748b;
      --line: #e5e7eb;
      --bg: #f8fafc;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      color: var(--ink);
      background: var(--bg);
    }

    header {
      background: #0f172a;
      color: white;
      padding: 12px 16px;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    h3 {
      margin: 10px 0;
    }

    .row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .col {
      flex: 1;
      min-width: 260px;
    }

    .card {
      background: white;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.04);
    }

    #toolbar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 10px 0;
    }

    button {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      background: white;
      cursor: pointer;
    }

    button.primary {
      background: #0ea5e9;
      color: white;
      border-color: #0ea5e9;
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(3, minmax(260px, 1fr));
      gap: 12px;
    }

    .control {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      background: white;
    }

    .control label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }

    .val {
      color: var(--muted);
      font-size: 12px;
    }

    input[type=range],
    input[type=number] {
      width: 100%;
    }

    .muted {
      color: var(--muted);
      font-size: 12px;
    }

    .grid3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .radio-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .alloc {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .alloc input[type=range] {
      width: 160px;
    }

    .pill {
      display: inline-block;
      padding: 3px 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }

    #status {
      margin-top: 8px;
      color: var(--muted);
    }

    #llmPanel {
      display: none;
    }

    textarea {
      width: 100%;
      min-height: 130px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    .sep {
      height: 1px;
      background: var(--line);
      margin: 12px 0;
    }

    .spark-wrap {
      position: relative;
    }

    .axis-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    canvas.spark {
      width: 100%;
      height: 120px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: white;
    }

    .tickbar {
      position: absolute;
      left: 4px;
      top: 4px;
      bottom: 4px;
      width: 40px;
      pointer-events: none;
    }

    #error {
      display: none;
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
      padding: 10px;
      border-radius: 8px;
      margin-top: 8px;
    }

    /* Parallel Monitor Styles */
    .worker-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .worker-id {
      font-weight: 600;
      min-width: 70px;
    }

    .worker-progress {
      flex: 1;
    }

    .worker-progress progress {
      width: 100%;
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
    }

    .worker-status {
      font-size: 12px;
      min-width: 140px;
      text-align: right;
      color: #64748b;
    }

    .worker-progress progress::-webkit-progress-bar {
      background: #e2e8f0;
    }

    .worker-progress progress::-webkit-progress-value {
      background: #22c55e;
    }
  </style>
</head>

<body>
  <header>
    <div><b>Financial Investment Task ‚Äî v1.1.1</b> ‚Ä¢ Factual ‚Üí Contextual ‚Üí Schematic</div>
  </header>
  <main>
    <div id="status">Loading‚Ä¶</div>
    <div id="error"></div>
    <div id="toolbar">
      <a href="../index.html" style="text-decoration:none;"><button id="backBtn" style="background:#e2e8f0;">üè† Back to
          Home</button></a>
      <button id="startBtn" class="primary" disabled>Start Experiment</button>
      <button id="downloadBtn" disabled style="display:none;">Download Data (JSON)</button>
      <button id="submitAllBtn" class="primary" style="display:none;">Submit All Data</button>
    </div>

    <div class="card" id="controls_panel" style="display: none;">
      <h3>Runtime Controls</h3>
      <div class="controls">
        <div class="control">
          <label>Trials <span class="val" id="v_trials"></span></label>
          <input id="T_trials" type="range" min="1" max="100" step="1" value="10">
        </div>
        <div class="control">
          <label>Window Length (W) <span class="val" id="v_W"></span></label>
          <input id="W_window" type="range" min="40" max="200" step="5">
        </div>
        <div class="control">
          <label>Trend Threshold (slope) <span class="val" id="v_thr"></span></label>
          <input id="trend_thresh" type="range" min="0.005" max="0.06" step="0.005">
        </div>
        <div class="control">
          <label>Calm‚ÜíTurb prob <span class="val" id="v_ct"></span></label>
          <input id="p_calm_to_turb" type="range" min="0.02" max="0.40" step="0.01">
        </div>
        <div class="control">
          <label>Turb‚ÜíCalm prob <span class="val" id="v_tc"></span></label>
          <input id="p_turb_to_calm" type="range" min="0.02" max="0.40" step="0.01">
        </div>
        <div class="control">
          <label>œÅ (calm) <span class="val" id="v_rhoc"></span></label>
          <input id="rho_calm" type="range" min="0.00" max="0.60" step="0.01">
        </div>
        <div class="control">
          <label>œÅ (turb) <span class="val" id="v_rhot"></span></label>
          <input id="rho_turb" type="range" min="0.10" max="0.95" step="0.01">
        </div>
        <div class="control">
          <label>œÉ (calm): L / M / H</label>
          <div class="row">
            <input id="sigma_calm_L" type="number" step="0.001" min="0.001">
            <input id="sigma_calm_M" type="number" step="0.001" min="0.001">
            <input id="sigma_calm_H" type="number" step="0.001" min="0.001">
          </div>
        </div>
        <div class="control">
          <label>œÉ (turb): L / M / H</label>
          <div class="row">
            <input id="sigma_turb_L" type="number" step="0.001" min="0.001">
            <input id="sigma_turb_M" type="number" step="0.001" min="0.001">
            <input id="sigma_turb_H" type="number" step="0.001" min="0.001">
          </div>
        </div>
      </div>
    </div>
    <div style="margin-top:8px;" class="muted">Means Œº_L=Œº_M=Œº_H are fixed and equal.</div>

    <!-- Parallel Execution Control Removed -->

    <div class="row" style="margin-top:12px;">
      <div class="col card">
        <h3>Stage A ‚Äî Factual (per-asset trend)</h3>
        <div class="grid3">
          <div>
            <div class="pill">Low risk (L)</div>
            <div class="spark-wrap">
              <canvas id="cL" class="spark" width="320" height="120"></canvas>
              <div id="ticksL" class="tickbar"></div>
            </div>
            <div class="axis-label">Œî% vs. time (steps)</div>
            <div class="radio-row">
              <label><input type="radio" name="trendL" value="up"> up</label>
              <label><input type="radio" name="trendL" value="flat" checked> flat</label>
              <label><input type="radio" name="trendL" value="down"> down</label>
            </div>
            <div>Confidence (0‚Äì100) <input id="confL" type="range" min="0" max="100" value="50"></div>
          </div>
          <div>
            <div class="pill">Medium risk (M)</div>
            <div class="spark-wrap">
              <canvas id="cM" class="spark" width="320" height="120"></canvas>
              <div id="ticksM" class="tickbar"></div>
            </div>
            <div class="axis-label">Œî% vs. time (steps)</div>
            <div class="radio-row">
              <label><input type="radio" name="trendM" value="up"> up</label>
              <label><input type="radio" name="trendM" value="flat" checked> flat</label>
              <label><input type="radio" name="trendM" value="down"> down</label>
            </div>
            <div>Confidence (0‚Äì100) <input id="confM" type="range" min="0" max="100" value="50"></div>
          </div>
          <div>
            <div class="pill">High risk (H)</div>
            <div class="spark-wrap">
              <canvas id="cH" class="spark" width="320" height="120"></canvas>
              <div id="ticksH" class="tickbar"></div>
            </div>
            <div class="axis-label">Œî% vs. time (steps)</div>
            <div class="radio-row">
              <label><input type="radio" name="trendH" value="up"> up</label>
              <label><input type="radio" name="trendH" value="flat" checked> flat</label>
              <label><input type="radio" name="trendH" value="down"> down</label>
            </div>
            <div>Confidence (0‚Äì100) <input id="confH" type="range" min="0" max="100" value="50"></div>
          </div>
        </div>
      </div>
      <div class="col card">
        <h3>Stage B ‚Äî Contextual (market risk)</h3>
        <div>How risky does the market feel right now?</div>
        <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
          <span class="muted">calm</span>
          <input id="ctxRisk" type="range" min="0" max="100" value="50">
          <span class="muted">turbulent</span>
        </div>
        <div class="muted" id="ctxLabel">reported: 50/100</div>
        <div class="sep"></div>
        <h3>Stage C ‚Äî Schematic (portfolio allocation)</h3>
        <div class="alloc"><span class="pill">L</span><input id="wL" type="range" min="0" max="100" step="5"
            value="33"><span id="vwL">33%</span></div>
        <div class="alloc"><span class="pill">M</span><input id="wM" type="range" min="0" max="100" step="5"
            value="33"><span id="vwM">33%</span></div>
        <div class="alloc"><span class="pill">H</span><input id="wH" type="range" min="0" max="100" step="5"
            value="34"><span id="vwH">34%</span></div>
        <div class="muted">Sum is enforced to 100%. Adjusting any slider rebalances the other two proportionally.</div>
        <div style="margin-top:10px;">
          <button id="submitTrial" class="primary">Submit Trial</button>
        </div>
      </div>
    </div>

    </div>
    </div>
    </div>

    <script src="./js/app_v111.js"></script>
</body>

</html>